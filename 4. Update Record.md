# Update Record in the Table
Steps on how to add an update button to edit a record on the table

## 1. Adding a update button
In the HTML `table`, the update button will be located at the action column, beside the delete button

In the Javascript code, locate the place where you populated the table with data by adding columns `td` and rows `tr`.
Just add the update `button` in the `td` where the delete `button` is placed.
```javascript
// Add action column
const tdAction = document.createElement('td');

// Create "Delete" button
const deleteButton = document.createElement('button');
deleteButton.textContent = "Delete";
deleteButton.addEventListener('click', () => deleteRow(data.id)); // Call delete function with the ID

// Create "Update" button
const updateButton = document.createElement('button');
updateButton.textContent = "Update";
updateButton.addEventListener('click', () => updateRow(data.id)); // Call update function with the ID

// Add the delete button to action column
tdAction.appendChild(deleteButton);
tdAction.appendChild(updateButton);
```
## 2. Add a separate button in the `#create-form` to save changes made to the record
Add a hidden field in the `#create-form` to store the record id.
```html
<input type="hidden" id="id">
```

Add an id for each button to easily identify it. The two buttons should have different click event handler.
```html
<div>
    <button id="new-save" type="button" onclick="save(event)">Save</button>
    <button id="edit-save" type="button" onclick="updateSave(event)">Save Changes</button> <!-- Add this extra button -->
</div>
```
Add a CSS to hide the `#edit-save` button by default.
```css
#edit-save{
    display:none;
}
```

## 3. Handle the update button click event by creating additional function `updateRow()` in the Javascript
Place it anywhere in the Javascript, just not within any other function.
```javascript
// Function to handle update
function updateRow(id){
    fetch(`/update?id=${id}`)  //Fetch the record from the server
    .then(response => response.json())
    .then(person => {
        // Hide and show buttons
        document.getElementById("edit-save").style.display="inline-block"; //Show #edit-save button
        document.getElementById("new-save").style.display="none"; //Hide #new-save button. This is for saving new entry only
        
        // Populate form
        document.getElementById("id").value = person.id;
        document.getElementById("fname").value = person.first_name;
        document.getElementById("lname").value = person.last_name;
        document.getElementById("gender").value = person.gender;
        document.getElementById("email").value = person.email;

        //Change form tile
        document.getElementById("form-title").textContent = "Update Record | " +person.last_name;
        
        //Scroll into form
        document.getElementById("create-form").scrollIntoView({ behavior: 'smooth', block: 'start' });
        
    })
    .catch(error =>{
        console.error('Error fetching data:', error);
    });
}
```

## 4. Handle the update action in the server side
This action fetches the detail of the single row to be edited.
## FOR JAVA
### Create another context `/update` or any name similar to the `fetch()` address you specified
```java
server.createContext("/update", exchange -> {
    // Extract the item ID to be deleted from the request, for example, from the URI
    String id = exchange.getRequestURI().getQuery().substring(3);

    try{
        // TO DO: Create connection to database
        
        //SQL query to fetch single row
        String sql = "SELECT * FROM persons WHERE id = ?";
        //Create a PreparedStatement
        PreparedStatement preparedStatement = dbConnection.prepareStatement(sql);
        preparedStatement.setInt(1, Integer.parseInt(id));

        //Execute query
        ResultSet resultSet = preparedStatement.executeQuery();
        JSONObject jsonObject = new JSONObject();
        while(resultSet.next()){   
            jsonObject.put("id", resultSet.getInt("id"));
            jsonObject.put("first_name", resultSet.getString("first_name"));
            jsonObject.put("last_name", resultSet.getString("last_name"));
            jsonObject.put("gender", resultSet.getString("gender"));
            jsonObject.put("email", resultSet.getString("email"));
        }
        //Convert JSON array object to String
        String jsonString = jsonObject.toString();
        //Close prepared statement
        preparedStatement.close();   
        //Close database connection
        dbConnection.close();
        
        // Send a response
        exchange.getResponseHeaders().set("Content-Type", "application/json");
        exchange.sendResponseHeaders(200, jsonString.length());
        OutputStream os = exchange.getResponseBody();
        os.write(jsonString.getBytes());
        os.close();
    }catch(SQLException e){
         throw new RuntimeException("An error occurred", e);
    }
});  
```
## FOR PYTHON
### Create another route `/update` or any name similar to the `fetch()` address you specified
```python
# Route for fetching single record to be updated
@app.route('/update', methods=['GET'])
def update_person():
    # Retrieve the "id" parameter from the query string of the request
    id = request.args.get("id")

    try:
        # TO DO: Establish a connection to the MariaDB database using provided connection parameters
        
        # TO DO: Create a cursor for executing SQL queries

        # Execute a SQL query to fetch a single person's record to be updated
        query = "SELECT * FROM persons WHERE id = %s"
        cursor.execute(query, (id,))

        # Fetch the result
        record = cursor.fetchone()

        # Close the cursor and database connection
        cursor.close()
        connection.close()

        if record:
            person = {
                "id": record[0],
                "first_name": record[1],
                "last_name": record[2],
                "gender": record[3],
                "email": record[4],
            }
            return jsonify(person), 200  # Return the record as JSON
        else:
            return jsonify({'message': 'Record not found'}), 404

    except Exception as e:
        # If an error occurs during the execution, print the error message
        print(f"Error: {e}")
        
        # Create an error dictionary and return it as a JSON response
        error = {"error": e}
        return jsonify(error)
```